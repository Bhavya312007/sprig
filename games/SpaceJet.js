/*
First time? Check out the tutorial game:
https://sprig.hackclub.com/gallery/getting_started

@title: draw
@author: 
@tags: []
@addedOn: 2025-00-00
*/

const player = "p"
const bullet = "b"
const alien = "a"
const blast = "k"

setLegend(
  [ player, bitmap`
................
................
......000.......
......060.......
.....0660.......
.....06660.0....
...0002620.0....
...0.0666000....
...0.06360......
.....06660......
....066660......
....06660.......
.....000........
.....0.0........
....00.00.......
................` ],
  [ bullet , bitmap`
................
................
................
.......0........
......000.......
.....00000......
....00.0.00.....
.......0........
.......0........
.......0........
.......0........
.......0........
................
................
................
................`],
  [ alien , bitmap`
................
................
.......0........
....00000000....
...0033333300...
...0303330330...
...0333333330...
...0033333300...
....00000000....
......000.......
.....00..0......
.....0...00.....
................
................
................
................`],
  [ blast , bitmap`
................
................
...666..66666...
..6633336.9.6...
..693338399.6...
..69333333..9...
..69993339899666
..99966333999996
669963333.399996
.9883336369..96.
.99863336999966.
..993369996966..
6996.99969.96...
6...6966.99.6...
66..666699..6...
..66....666.6...`]
)

setSolids([])

let level = 0
const levels = [
  map`
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
....................
p...................`
]

setMap(levels[level])

setPushables({
  [ player ]: []
})

let score = 0

/*onInput("w", () => {
  getFirst(player).y -= 1
})
onInput("s", () => {
  getFirst(player).y += 1
})*/
onInput("a", () => {
  getFirst(player).x -= 1
})
onInput("d", () => {
  getFirst(player).x += 1
})

onInput("l", () => {
  addSprite(getFirst(player).x , getFirst(player).y -1, bullet)
})

setInterval(()=>{
  // erasing blasts
    for (let i = getAll(blast).length - 1; i >= 0; i--) {
      let b = getAll(blast)[i]
      b.remove()
      getAll(blast).splice(i, 1)
      score +=1
    }

  //clearText()
    addText(`Score :${score}`, {
       x: 0,
       y: 0,
   color: color`3`
  })
  
},200)
setInterval(() => {  
  //moving bullets
  for (let i = getAll(bullet).length - 1; i >= 0; i--) {
    let b = getAll(bullet)[i]
    if ( b.y > 0) {
      b.y -= 1
    } else {
      b.remove()
      getAll(bullet).splice(i, 1)
    }

    
    // ðŸ’¥ Check if this bullet hits an alien
    let tile = getTile(b.x, b.y)
    for (let s of tile) {
      if (s.type === alien) {
        s.remove()  // remove alien
        b.remove()  // remove bullet
        addSprite(b.x , b.y, blast)
        break
      }
    }
    
  }

  //check for alien meeting bullet
  

  
}, 100)  // update every 100ms

setInterval(()=>{
  // moving aliens
  addSprite(0 , 0, alien)
  
  for (let i = getAll(alien).length - 1; i >= 0; i--) {
    let a = getAll(alien)[i]

    if( a.y%2==1 ){
      if(a.x==width()-1) a.y+=1
      else a.x+=1
    }
    else {
      if(a.x==0) a.y+=1
      else a.x-=1
    }
    
    
  }
},1000)



afterInput(() => {
  
})